version: '3.8'

services:
  backend:
    image: ghcr.io/notyusheng/gesturegpt:latest
    container_name: gesturegpt-backend
    ports:
      - "8000:8000"
    environment:
      # Server config
      - HOST=0.0.0.0
      - PORT=8000
      - API_TITLE=GestureGPT
      - API_VERSION=1.0.0

      # LLM Configuration - see .env.example for options
      - LLM_PROVIDER=${LLM_PROVIDER:-placeholder}

      # OpenAI (if LLM_PROVIDER=openai)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-3.5-turbo}

      # Anthropic (if LLM_PROVIDER=anthropic)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - ANTHROPIC_MODEL=${ANTHROPIC_MODEL:-claude-3-haiku-20240307}

      # Custom LLM (if LLM_PROVIDER=custom)
      - CUSTOM_LLM_ENDPOINT=${CUSTOM_LLM_ENDPOINT:-http://host.docker.internal:1234/v1/chat/completions}
      - CUSTOM_LLM_MODEL=${CUSTOM_LLM_MODEL:-local-model}
    volumes:
      # Mount volumes for persistent video storage
      - ../output:/app/output
      - ../static:/app/static
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  demo:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gesturegpt-demo
    ports:
      - "8501:8501"
    environment:
      - SIGNALAPI_URL=http://backend:8000
    depends_on:
      - backend
    restart: unless-stopped

networks:
  default:
    name: gesturegpt-network
